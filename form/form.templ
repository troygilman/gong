package form

import "github.com/troygilman/gong/hooks"
import "net/http"
import "github.com/troygilman/gong"

templ New(opts ...Option) {
	{{
		c := Config{
			method: http.MethodPost,
			swap:   gong.SwapInnerHTML,
		}
		for _, opt := range opts {
			c = opt(c)
		}
	}}
	<form
		if c.method == http.MethodGet {
			hx-get
		}
		if c.method == http.MethodPost {
			hx-post
		}
		if c.method == http.MethodPatch {
			hx-patch
		}
		if c.method == http.MethodDelete {
			hx-delete
		}
		hx-swap={ c.swap }
		if c.target != "" {
			hx-target={ c.target }
		} else {
			hx-target={ "#" + hooks.ComponentID(ctx) }
		}
		if c.trigger != nil {
			hx-trigger={ *c.trigger }
		}
		hx-headers={ hooks.ActionHeaders(ctx, c.headers...) }
		if c.classes != nil {
			class={ c.classes }
		}
		{ c.attrs... }
	>
		{ children... }
	</form>
}

type Config struct {
	method  string
	swap    string
	target  string
	headers []string
	trigger *string
	attrs   templ.Attributes
	classes templ.CSSClasses
}

type Option func(Config) Config

func WithMethod(method string) Option {
	return func(c Config) Config {
		c.method = method
		return c
	}
}

func WithHeaders(headers ...string) Option {
	return func(c Config) Config {
		c.headers = headers
		return c
	}
}

func WithAttrs(attrs templ.Attributes) Option {
	return func(c Config) Config {
		c.attrs = attrs
		return c
	}
}

func WithSwap(swap string) Option {
	return func(c Config) Config {
		c.swap = swap
		return c
	}
}

func WithClasses(classes ...any) Option {
	return func(c Config) Config {
		c.classes = templ.Classes(classes)
		return c
	}
}

func WithTarget(target string) Option {
	return func(c Config) Config {
		c.target = target
		return c
	}
}

func WithTrigger(trigger string) Option {
	return func(c Config) Config {
		c.trigger = &trigger
		return c
	}
}
